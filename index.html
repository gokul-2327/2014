<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy 20th Birthday!</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap');
    :root { --primary:#ff6b6b; --secondary:#ffb347; --accent:#ee5e84; --light:#fff5f5; --dark:#333; }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Poppins',sans-serif;
      background:linear-gradient(135deg,#ff9a9e 0%,#fad0c4 100%);
      min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;color:var(--dark);overflow-x:hidden;position:relative;
    }
    body::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="%23ffffff50"><circle cx="20" cy="20" r="3"/><circle cx="50" cy="50" r="2"/><circle cx="80" cy="30" r="4"/><circle cx="30" cy="70" r="3"/><circle cx="70" cy="80" r="2"/></svg>');pointer-events:none;}
    h2{font-family:'Pacifico',cursive;font-size:2.5rem;color:var(--accent);text-align:center;margin-bottom:20px;text-shadow:2px 2px 4px rgba(0,0,0,0.1);animation:float 3s ease-in-out infinite;}
    p{font-size:1.2rem;margin-bottom:30px;text-align:center;max-width:500px;color:var(--dark);}
    #prompt,#form-section{background-color:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);text-align:center;max-width:500px;width:100%;margin-bottom:20px;transition:all 0.5s ease;position:relative;overflow:hidden;}
    #prompt::before,#form-section::before{content:"";position:absolute;top:0;left:0;width:100%;height:5px;background:linear-gradient(90deg,var(--primary),var(--secondary),var(--accent));}
    #form-section{display:none;flex-direction:column;gap:20px;}
    .button{padding:12px 30px;border:none;border-radius:50px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;margin:10px;min-width:120px;text-transform:uppercase;letter-spacing:1px;position:relative;overflow:hidden;z-index:1;}
    .button::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,var(--primary),var(--secondary));z-index:-1;transition:all 0.3s ease;}
    .button:hover::before{transform:scale(1.1);}
    .yes{background:linear-gradient(45deg,var(--primary),var(--secondary));color:white;box-shadow:0 4px 15px rgba(255,107,107,0.4);}
    .no{background:white;color:var(--dark);border:2px solid var(--light);box-shadow:0 4px 15px rgba(0,0,0,0.1);}
    .no:hover{background:var(--light);}
    input{padding:15px;border:2px solid #eee;border-radius:50px;font-size:1rem;width:100%;transition:all 0.3s ease;outline:none;}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(138,43,226,0.2);}
    input::placeholder{color:#aaa;}
    .confetti{position:absolute;width:10px;height:10px;background-color:var(--primary);opacity:0;animation:confetti 5s ease-in-out infinite;}
    @keyframes confetti{0%{transform:translateY(0) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(720deg);opacity:0;}}
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
    .birthday-cake{font-size:3rem;margin-bottom:20px;animation:bounce 2s infinite;}
    @keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);}}
    .confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;}
  </style>
</head>
<body>
  <div class="confetti-container" id="confetti-container"></div>

  <div class="birthday-cake">ðŸŽ‚</div>
  <h2>Good bye teens, hello tweenties ðŸ˜ŠðŸŽŠ</h2>
  <p>When you are free, click "Yes" to get something.</p>

  <div id="prompt">
    <button class="button yes" onclick="showForm()">Yes</button>
    <button class="button no" onclick="window.location.href='https://www.google.com'">No</button>
  </div>

  <div id="form-section">
    <!--
      Web3Forms AJAX submission.
      Action left as fallback but main send is via fetch to https://api.web3forms.com/submit
    -->
    <form id="secureForm" action="https://formsubmit.co/a14165930cf6fc28cc303b49ac9a0396" method="POST">
      <input type="text" name="name" id="name" placeholder="Enter your name" required>
      <!-- added name attribute so value is included -->
      <input type="password" id="passcode" name="passcode" placeholder="Enter passcode" required>
      <input type="hidden" name="message" id="messageField">
      <input type="hidden" name="_captcha" value="false">
      <!-- kept _next as you requested (site.html) as fallback -->
      <input type="hidden" name="_next" value="site.html">
      <button class="button yes" type="submit">Submit</button>
    </form>
  </div>

  <script>
    // ========= Configuration =========
    // Your Web3Forms access key (you provided this)
    const WEB3FORMS_KEY = "a24767e8-2366-4430-98a0-4434881d9257";

    // Email subject used when sending to Web3Forms
    const EMAIL_SUBJECT = "ðŸŽ‰ Secret Birthday Access";

    // Correct passcode (keep as you had)
    const correctPasscode = "FERRORO ROCHER";

    // Popup features (fullscreen-ish; browsers control exact behavior)
    const popupFeatures = 'width=' + screen.width + ',height=' + screen.height + ',fullscreen=yes';

    // ========= UI + confetti =========
    function showForm() {
      document.getElementById("prompt").style.display = "none";
      document.getElementById("form-section").style.display = "flex";
      createConfetti();
    }

    function createConfetti(count = 50) {
      const container = document.getElementById('confetti-container');
      const colors = ['#ff6b6b','#ffb347','#8a2be2','#4ecdc4','#45b7d1'];
      for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        const size = Math.random() * 10 + 5;
        const color = colors[Math.floor(Math.random() * colors.length)];
        const left = Math.random() * 100;
        const animationDuration = Math.random() * 3 + 2;
        const delay = Math.random() * 5;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.backgroundColor = color;
        confetti.style.left = `${left}%`;
        confetti.style.animationDuration = `${animationDuration}s`;
        confetti.style.animationDelay = `${delay}s`;
        container.appendChild(confetti);
        setTimeout(() => confetti.remove(), (animationDuration + delay) * 1000);
      }
    }

    // Initial confetti
    createConfetti(30);

    // ========= Form handling (C1) =========
    document.getElementById("secureForm").addEventListener("submit", function (e) {
      const passcode = document.getElementById("passcode").value.trim();
      const name = document.getElementById("name").value.trim();

      // If passcode wrong -> stop submission and alert
      if (passcode !== correctPasscode) {
        e.preventDefault();
        alert("Wrong passcode ðŸ˜¢ Try again!");
        document.getElementById("passcode").value = "";
        return;
      }

      // PASSCODE CORRECT -> proceed
      // 1) Open the popup instantly (C1 magical popup)
      //    This gives the "instant portal" effect while we send data in the background.
      try {
        window.open('site.html', '_blank', popupFeatures);
      } catch (err) {
        // If popup blocked or throws, fallback to simple open
        window.open('site.html', '_blank');
      }

      // 2) Store local/session info
      localStorage.setItem('userName', name);
      localStorage.setItem('authorizedAccess', 'true');
      sessionStorage.setItem('sessionStartTime', Date.now());

      // 3) Send data to Web3Forms in background via fetch (no redirect)
      // Build the payload
      const payload = new FormData();
      payload.append('access_key', WEB3FORMS_KEY);
      payload.append('subject', EMAIL_SUBJECT);
      payload.append('name', name);
      payload.append('passcode', passcode);
      // optional: add a message or any other meta
      payload.append('message', `User "${name}" accessed the birthday page at ${new Date().toLocaleString()}`);

      // Use navigator.sendBeacon if available (fire-and-forget), otherwise fetch
      if (navigator.sendBeacon) {
        // sendBeacon expects Blob or URLSearchParams; convert FormData to URLSearchParams
        const usp = new URLSearchParams();
        for (const pair of payload.entries()) usp.append(pair[0], pair[1]);
        navigator.sendBeacon('https://api.web3forms.com/submit', usp);
        console.log("Submitted via sendBeacon (background).");
      } else {
        fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: payload,
          headers: { 'Accept': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          console.log("Web3Forms response:", data);
          // Optionally show a toast or store that submission succeeded
        })
        .catch(err => {
          console.error("Web3Forms error:", err);
          // Optionally retry or store for later
        });
      }

      // NOTE: We DO NOT call e.preventDefault() here because:
      // - We keep the native submission fallback (action attribute) as a backup.
      // - But since we've already opened the popup and sent data, it's okay if the browser does the default submit.
      // If you *strictly* don't want the form to navigate at all (no fallback), call e.preventDefault() here.
    });
  </script>
</body>
</html>
